<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Leitor de Notas - ZIP e Excel</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    input { margin: 10px 0; display: block; }
    h2 { color: #2c3e50; }
    #resultadoZip, #resultadoExcel { margin-top: 10px; font-weight: bold; background: #fff; padding: 10px; border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
  </style>
</head>
<body>

  <h2>1️⃣ Contar Arquivos XML em um Arquivo ZIP</h2>
  <input type="file" id="zipInput" accept=".zip">
  <div id="resultadoZip"></div>

  <hr>

  <h2>2️⃣ Contar Notas de um Arquivo Excel (a partir da célula I3)</h2>
  <input type="file" id="excelInput" accept=".xlsx, .xls">
  <div id="resultadoExcel"></div>

  <script>
    // === ZIP - Contar arquivos XML ===
    document.getElementById('zipInput').addEventListener('change', function(event) {
      const file = event.target.files[0];
      const resultadoDiv = document.getElementById('resultadoZip');

      if (!file) {
        resultadoDiv.textContent = "Nenhum arquivo selecionado.";
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        JSZip.loadAsync(e.target.result).then(function(zip) {
          let count = 0;
          zip.forEach(function (relativePath, zipEntry) {
            if (zipEntry.name.toLowerCase().endsWith(".xml")) {
              count++;
            }
          });
          resultadoDiv.textContent = `Total de arquivos XML no ZIP: ${count}`;
        }).catch(function(err) {
          resultadoDiv.textContent = "Erro ao ler o arquivo ZIP: " + err;
        });
      };
      reader.readAsArrayBuffer(file);
    });

    // === Excel - Contar apenas as notas a partir da célula I3 ===
    document.getElementById('excelInput').addEventListener('change', function(event) {
      const file = event.target.files[0];
      const resultadoDiv = document.getElementById('resultadoExcel');

      if (!file) {
        resultadoDiv.textContent = "Nenhum arquivo selecionado.";
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];

        let count = 0;
        let row = 3; // começa na linha 3 (I3)
        while (true) {
          const cellAddress = `I${row}`;
          const cell = sheet[cellAddress];
          if (!cell || !cell.v) break; // para quando encontrar célula vazia
          count++;
          row++;
        }

        resultadoDiv.textContent = `Total de notas encontradas na coluna I (a partir de I3): ${count}`;
      };

      reader.readAsArrayBuffer(file);
    });
  </script>

</body>
</html>
